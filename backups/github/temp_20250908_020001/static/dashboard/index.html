<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartArb Engine - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .status { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px; backdrop-filter: blur(10px); }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; backdrop-filter: blur(10px); transition: transform 0.3s ease; }
        .metric-card:hover { transform: translateY(-5px); }
        .metric-title { font-size: 0.9em; opacity: 0.8; margin-bottom: 5px; }
        .metric-value { font-size: 1.8em; font-weight: bold; }
        .positive { color: #4CAF50; }
        .negative { color: #f44336; }
        .controls { text-align: center; }
        .btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 24px; border-radius: 25px; cursor: pointer; margin: 0 10px; transition: all 0.3s ease; }
        .btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
        .live-indicator { display: inline-block; width: 10px; height: 10px; background: #4CAF50; border-radius: 50%; animation: pulse 2s infinite; margin-right: 8px; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ SmartArb Engine</h1>
            <p>Professional Cryptocurrency Arbitrage Trading Bot</p>
        </div>

        <div class="status">
            <h3>ðŸ“Š System Status</h3>
            <p><span class="live-indicator"></span><span id="lastUpdate">Last update: Loading...</span></p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">ðŸ“ˆ Total Trades</div>
                <div class="metric-value" id="totalTrades">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">ðŸŽ¯ Success Rate</div>
                <div class="metric-value" id="successRate">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">ðŸ’° Total Profit</div>
                <div class="metric-value positive" id="totalProfit">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">ðŸ“Š Daily P&L</div>
                <div class="metric-value" id="dailyPnl">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">ðŸ§  Memory Usage</div>
                <div class="metric-value" id="memoryUsage">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">âš¡ CPU Usage</div>
                <div class="metric-value" id="cpuUsage">--</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="refreshDashboard()">ðŸ”„ Refresh</button>
            <button class="btn" onclick="testTelegram()">ðŸ“± Test Telegram</button>
            <button class="btn" onclick="showLogs()">ðŸ“‹ Logs</button>
        </div>
    </div>

    <script>
        let updateInterval;
        
        function refreshDashboard() {
            updateMetrics();
        }
        
        function testTelegram() {
            fetch('/api/test/telegram', {method: 'POST'})
                .then(r => r.json())
                .then(data => alert(data.ok ? 'âœ… Telegram OK!' : 'âŒ Telegram Error: ' + data.error))
                .catch(e => alert('âŒ Test failed: ' + e));
        }
        
        function showLogs() {
            window.open('/api/logs', '_blank');
        }
        
        async function updateMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                
                document.getElementById('totalTrades').textContent = data.trades_executed || '--';
                document.getElementById('successRate').textContent = (data.success_rate || 0).toFixed(1) + '%';
                document.getElementById('totalProfit').textContent = '$' + (data.total_profit || 0).toFixed(2);
                
                const pnl = data.daily_pnl || 0;
                const pnlElement = document.getElementById('dailyPnl');
                pnlElement.textContent = (pnl >= 0 ? '+$' : '$') + pnl.toFixed(2);
                pnlElement.className = 'metric-value ' + (pnl >= 0 ? 'positive' : 'negative');
                
                document.getElementById('memoryUsage').textContent = (data.memory_usage || 0).toFixed(1) + '%';
                document.getElementById('cpuUsage').textContent = (data.cpu_usage || 0).toFixed(1) + '%';
                
                document.getElementById('lastUpdate').textContent = 
                    'Last update: ' + new Date().toLocaleTimeString() + ' (Auto-refresh every 10s)';
                    
            } catch (error) {
                console.error('Update failed:', error);
                document.getElementById('lastUpdate').textContent = 
                    'Update failed - ' + new Date().toLocaleTimeString();
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateMetrics();
            // Auto-refresh ogni 10 secondi (no WebSocket needed)
            updateInterval = setInterval(updateMetrics, 10000);
        });
    </script>
</body>
</html>
